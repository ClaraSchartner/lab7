---
title: "Ridge Regression"
author: "Clara Schartner and Araya Eamrurksiri"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r, echo=FALSE}
data("iris")
data("faithful")
```
## Ridge Regression
The Package `lab7` includes a function called `ridgreg` with which it is possible to do a ridge regression on data.
$\hat \beta^{ridge}=(X´X+ \lambda I)^{-1} X´y$ 
## Example
The use of the function is as can be seen below:
```{r}
library(lab7)
result<-ridgereg(eruptions~waiting,faithful)
result
```
## Further features
The function `predict` can be used to extract all predicted values.
```{r}
head(predict(result))
```
The function `coef` extracts all coefficients.
```{r}
coef(result)
```
And the function `print` prints both the formula used and the coefficients.
```{r}
print(result)
```

##Predictive
```{r}
library(mlbench)
library(caret)
data("BostonHousing")
BostonHousing$chas <- as.numeric(BostonHousing$chas)-1 ##CHECK!!
intrain<-createDataPartition(BostonHousing$crim, p=0.75, list=FALSE)
training<-BostonHousing[intrain,]
testing<-BostonHousing[-intrain,]

#testing2 <- train(crim~.,data=testing)


#fit a linear regression model 
lm.s<-train(crim ~ .,data = training, method = "lm")


#fit a linear regression model with forward selection
lm.fore<-train(crim ~ .,data = training, method = "leapForward")

pre.fore<-predict(newdata=testing, lm.fore)
#confusionMatrix(data=pre.fore, testing$crim) #not working!! maybe because metric?
 plot(testing$crim,col="red")
 lines(pre.fore)


 
#evaluate performance of linear regression model on training dataset
pre.lm.train <- predict(lm.s, newdata=training)

#evaluate performance of linear regression model on test dataset
pre.lm<-predict(newdata=testing, lm.s)

#confusionMatrix(data=pre.lm, testing$crim)
plot(testing$crim,col="red")
 lines(pre.lm)
 
 
 #10foldcross <- trainControl(method = "repeatedcv", repeats=1)

# confusionMatrix(data=pre.lm, testing$crim)

#evaluate performance of linear regression model with forward selection on test dataset
#pre.fore<-predict(newdata=testing, lm.fore) #i dont think this should be like this, see below

plot(testing$crim,col="red",type="l")
lines(pre.fore)

 
#tenfoldcross <- trainControl(method = "repeatedcv", repeats=10)








#include custom method "ridge" #changed the name 
ridge <- list(type=c("Regression"), 
                 library="lab7",
                 loop=NULL)

#the parameter element
ridge$parameters <- data.frame(parameter="lambda",
                  class="numeric",
                  label="lambda")


#the grid element
ridge$grid <- function(y,x, len=NULL, search="grid"){
 data.frame(lambda=c(0.01,0.5,1,3,8,30))
}

#ridge$grid <- ridge.grid

#the fit element
Fit <- function(y, x, lambda, param, lev, last, classProbs, ...){
  #library(lab7)
   lab7::ridgereg1(y=y, x=x, lambda=param$lambda) 
}

ridge$fit <- Fit
ridge$prob<-list(NULL)

ridge$predict<-function(modelFit, newdata,preProc=NULL, submodels=NULL){
  predict(modelFit, newdata)
}


ridge$sort<-function (x) x[order(-x$lambda), ]
ridge$label<-"Ridge"
fitControl <- trainControl(
  method = "repeatedcv",
  number = 2,
  repeats = 2)
#fit a ridge regresstion 
#ridgeTrain <- train(y=training$crim, x=training[,-1], method=ridge, trControl = fitControl)
#ridgeTrain              
```

